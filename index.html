<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çŒœæ•°å­—</title>
    <style>
        /* ------------------------------------------------------------
            ç°ä»£æ¸¸æˆé£æ ¼ Â· æ— åœ†è§’ Â· æ— è¡¨æ ¼é˜´å½± Â· æˆ˜æŠ¥å·¦å³
            ç§˜å¯†æ¨¡å¼ï¼šæ·±çº¢ä¸»é¢˜ + è·³åŠ¨ä¹±ç 
        ------------------------------------------------------------ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            border-radius: 0 !important;
        }

        html, body {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #0c1a1f, #030607);
            font-family: 'Inter', 'Courier New', 'SF Mono', 'Fira Code', monospace;
            overflow: hidden;
            letter-spacing: 0.3px;
            transition: background 0.2s;
        }

        /* ç§˜å¯†æ¨¡å¼ï¼šæ·±çº¢è¦†ç›– */
        html.secret-mode, .secret-mode body {
            background: radial-gradient(circle at 50% 50%, #2a0c0c, #1a0303) !important;
        }
        .secret-mode #app {
            border-color: #8b2b2b !important;
            box-shadow: 0 0 25px rgba(255, 50, 50, 0.3) !important;
            background: rgba(30, 10, 12, 0.85) !important;
        }
        .secret-mode .header-row {
            border-bottom-color: #8b3a3a !important;
            background: #1e0e10 !important;
            background-image: linear-gradient(145deg, #201214, #150a0b) !important;
            box-shadow: 0 6px 0 #3a1e1e !important;
        }
        .secret-mode .game-title {
            color: #ffb3b3 !important;
            text-shadow: 0 0 8px #c44f4f, 0 0 2px #ff8a8a !important;
        }
        .secret-mode .difficulty-display,
        .secret-mode .method-toggle,
        .secret-mode .reset-table-btn {
            border-color: #b55454 !important;
            color: #ffc9c9 !important;
            background: #221213 !important;
            box-shadow: inset 0 -4px 0 #4f2525, inset 0 2px 0 #d67a7a !important;
        }
        .secret-mode .left-play-area,
        .secret-mode .middle-history-area,
        .secret-mode .right-table-area {
            border-color: #8b4040 !important;
            background: #1f1113 !important;
            background: linear-gradient(145deg, #201516, #1b0e0f) !important;
            box-shadow: 10px 10px 0 #2e1919 !important;
        }
        .secret-mode .grid-table {
            border-color: #b15858 !important;
        }
        .secret-mode .grid-table td {
            border-color: #a14b4b !important;
            color: #ffd8d8 !important;
            text-shadow: 0 0 6px #d64a4a !important;
            box-shadow: inset 0 0 12px #2a0f0f !important;
        }

        /* è·³åŠ¨ä¹±ç åŠ¨ç”» */
        @keyframes glitch {
            0% { transform: translate(0, 0) skew(0deg); opacity: 1; }
            20% { transform: translate(-2px, 1px) skew(2deg); opacity: 0.9; }
            40% { transform: translate(2px, -1px) skew(-2deg); opacity: 0.95; }
            60% { transform: translate(-1px, 2px) skew(1deg); opacity: 0.9; }
            80% { transform: translate(1px, -2px) skew(-1deg); opacity: 0.95; }
            100% { transform: translate(0, 0) skew(0deg); opacity: 1; }
        }
        .secret-mode .glitch-text {
            animation: glitch 0.3s infinite !important;
            display: inline-block;
        }
        .secret-mode .game-title,
        .secret-mode .difficulty-display span,
        .secret-mode .method-toggle,
        .secret-mode .reset-table-btn,
        .secret-mode label,
        .secret-mode .history-header span,
        .secret-mode .history-guess,
        .secret-mode .history-result,
        .secret-mode .grid-table td,
        .secret-mode .error-message,
        .secret-mode .win-message,
        .secret-mode .howto-btn,
        .secret-mode .tutorial-panel,
        .secret-mode .tutorial-panel h3,
        .secret-mode .tutorial-panel p,
        .secret-mode .empty-history {
            animation: glitch 0.25s infinite !important;
        }

        #app {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: rgba(10, 20, 24, 0.75);
            backdrop-filter: blur(4px);
            color: #b7f0b1;
            border: 3px solid #2b8c5e;
            box-shadow: 0 0 25px rgba(0, 255, 100, 0.2);
            overflow: hidden;
            transition: all 0.2s;
        }

        .app-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* ===== é¡µçœ‰ ===== */
        .header-row {
            flex: 0 0 90px;
            border-bottom: 3px solid #2b8c5e;
            padding: 0 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0e1b1f;
            background-image: linear-gradient(145deg, #0f1e22 0%, #0a1518 100%);
            position: relative;
            z-index: 100;
            box-shadow: 0 6px 0 rgba(0, 30, 20, 0.7);
        }

        .game-title {
            font-size: 36px;
            font-weight: 700;
            line-height: 1;
            display: flex;
            align-items: center;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #aaf0b0;
            text-shadow: 0 0 8px #1f9a5a, 0 0 2px #8fec9f;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 22px;
            position: relative;
            height: 100%;
        }

        .difficulty-display {
            font-size: 24px;
            padding: 8px 28px;
            background: #0d181c;
            color: #baf0b6;
            border: 2.5px solid #2a9d6e;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 14px;
            position: relative;
            white-space: nowrap;
            height: 58px;
            font-weight: 600;
            transition: all 0.06s ease-in;
            box-shadow: inset 0 -4px 0 #0f3a2a, inset 0 2px 0 #63d6a1;
        }
        .difficulty-display:hover {
            background: #15302b;
            border-color: #44d68a;
            color: #ebffed;
            box-shadow: inset 0 -3px 0 #1f5e45, inset 0 3px 0 #a5f0c5;
        }

        .difficulty-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: #0e1a1c;
            border: 2.5px solid #1e8b5c;
            width: auto;
            min-width: 100%;
            z-index: 200;
            margin-top: 6px;
            white-space: nowrap;
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.5);
        }
        .difficulty-menu-item {
            padding: 16px 32px;
            font-size: 22px;
            color: #c6f7c0;
            border-bottom: 2px solid #1c6b4a;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 500;
            background: #0f1f20;
            transition: 0.04s linear;
        }
        .difficulty-menu-item:last-child {
            border-bottom: none;
        }
        .difficulty-menu-item:hover {
            background: #1f4943;
            color: white;
            border-left: 8px solid #4ad68e;
        }

        .method-toggle, .reset-table-btn {
            font-size: 24px;
            padding: 8px 28px;
            background: #0d181c;
            color: #baf0b6;
            border: 2.5px solid #2a9d6e;
            cursor: pointer;
            white-space: nowrap;
            height: 58px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.06s;
            box-shadow: inset 0 -4px 0 #0f3a2a, inset 0 2px 0 #63d6a1;
        }
        .method-toggle:hover, .reset-table-btn:hover {
            background: #15302b;
            border-color: #44d68a;
            color: #ebffed;
            box-shadow: inset 0 -3px 0 #1f5e45, inset 0 3px 0 #a5f0c5;
        }

        /* ç§˜å¯†æ¨¡å¼ä¸‹ç¦ç”¨æŒ‰é’®æ ·å¼ */
        .secret-mode .method-toggle:not(.guess-btn-only),
        .secret-mode .reset-table-btn,
        .secret-mode .howto-btn,
        .secret-mode .difficulty-display,
        .secret-mode .button-group button:not(.guess-btn) {
            opacity: 0.5 !important;
            pointer-events: none !important;
            cursor: not-allowed !important;
        }
        
        /* çŒœæµ‹æŒ‰é’®å§‹ç»ˆä¿æŒå¯ç”¨ */
        .guess-btn, .button-group button:first-child {
            position: relative;
            z-index: 999;
        }
        .secret-mode .guess-btn, 
        .secret-mode .button-group button:first-child {
            opacity: 1 !important;
            pointer-events: auto !important;
            border-color: #ff7e7e !important;
            background: #3a1e1e !important;
        }

        /* ===== ä¸‰åˆ—æ ¸å¿ƒ ===== */
        .main-three-columns {
            flex: 1 1 0;
            display: flex;
            flex-direction: row;
            min-height: 0;
            width: 100%;
            overflow: hidden;
            padding: 28px;
            gap: 28px;
            background: radial-gradient(ellipse at top, #0d1a1c, #091012);
        }

        .left-play-area, 
        .middle-history-area, 
        .right-table-area {
            flex: 1 1 0;
            display: flex;
            flex-direction: column;
            border: 3px solid #1b6e4c;
            background: #0c181c;
            background: linear-gradient(145deg, #0d1c1e, #0a1518);
            overflow: hidden;
            min-width: 0;
            box-shadow: 10px 10px 0 rgba(0, 20, 10, 0.6);
        }

        /* å·¦ä¾§ä¸»æ§åˆ¶åŒº */
        .left-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 30px 20px;
            gap: 24px;
        }

        .left-inner > * {
            width: 100%;
            max-width: 360px;
        }

        .row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            width: 100%;
        }

        label {
            font-size: 24px;
            font-weight: 600;
            white-space: nowrap;
            color: #b2edb2;
            text-shadow: 0 0 4px #208a4a;
        }

        .guess-input {
            flex: 1;
            min-width: 0;
            max-width: 240px;
            font-size: 24px;
            padding: 12px 16px;
            background: #0a171b;
            color: #dcffe7;
            border: 3px solid #2d8f62;
            font-weight: 500;
            height: 60px;
            box-shadow: inset 0 0 10px #030e0c, inset 0 2px 0 #50ba85;
        }
        .guess-input::placeholder {
            color: #7bcba1;
            opacity: 0.9;
            font-weight: 400;
            letter-spacing: 1px;
        }
        .guess-input:focus {
            background: #0d2224;
            border-color: #52d494;
            outline: none;
            box-shadow: inset 0 0 12px #0a302a, 0 0 12px #2dae74;
        }

        .button-group {
            display: flex;
            gap: 18px;
            justify-content: center;
            width: 100%;
        }
        .button-group button {
            flex: 1;
            max-width: 140px;
            font-size: 24px;
            padding: 12px 0;
            background: #10292a;
            color: #d3ffd0;
            border: 2.5px solid #2aad70;
            cursor: pointer;
            height: 60px;
            font-weight: 650;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            transition: 0.06s;
            box-shadow: inset 0 -5px 0 #10412e, inset 0 2px 0 #92e7b5;
        }
        .button-group button:hover {
            background: #1a463e;
            border-color: #4ce69a;
            box-shadow: inset 0 -4px 0 #1d6346, inset 0 4px 0 #c2ffd6;
        }

        .error-message, .win-message {
            width: 100%;
            padding: 18px 12px;
            margin: 0;
            font-size: 22px;
            line-height: 1.4;
            text-align: center;
            font-weight: 600;
            border-width: 3px;
            border-style: solid;
        }
        .error-message {
            color: #ffe1ac;
            background: #271c0a;
            border-color: #dc8b2b;
            box-shadow: inset 0 0 20px #341f06, 0 6px 0 #5e3e15;
        }
        .win-message {
            color: #fcfcaa;
            background: #0d2a1c;
            border-color: #f0e65c;
            box-shadow: inset 0 0 20px #1d4624, 0 6px 0 #698b2a;
        }

        .howto-btn {
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            font-size: 24px;
            padding: 12px;
            background: #0f2a26;
            color: #c6f7bc;
            border: 2.5px solid #289f6c;
            cursor: pointer;
            height: 60px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.06s;
            box-shadow: inset 0 -4px 0 #0a3d2c;
        }
        .howto-btn:hover {
            background: #1f4a40;
            border-color: #54d692;
        }

        .tutorial-panel {
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            border: 3px solid #2d9c6e;
            padding: 24px 20px;
            background: #0b1d1c;
            background: linear-gradient(165deg, #0b1e1e, #0c1b1b);
            font-size: 20px;
            line-height: 1.9;
            color: #d4fad4;
            box-shadow: inset 0 0 20px #051313, 8px 8px 0 #0e322a;
        }
        .tutorial-panel h3 {
            font-size: 26px;
            margin-bottom: 18px;
            border-bottom: 3px solid #31b87b;
            padding-bottom: 10px;
            color: #dbffc5;
            text-shadow: 0 0 6px #208e4a;
        }

        /* å†å²åŒºåŸŸ â€” æˆ˜æŠ¥å·¦å³å¸ƒå±€ */
        .middle-history-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 20px;
        }

        .history-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 380px;
            height: 100%;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 22px;
            font-size: 24px;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 4px solid #1f8e5a;
            color: #c6f7c6;
            text-shadow: 0 0 5px #197a4b;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            font-size: 22px;
            line-height: 1.9;
            width: 100%;
            padding-right: 6px;
            scrollbar-width: thin;
            scrollbar-color: #28975e #0a1a1a;
        }
        .history-list::-webkit-scrollbar {
            width: 8px;
            background: #0e1f1f;
        }
        .history-list::-webkit-scrollbar-thumb {
            background: #218353;
            border: none;
        }

        .history-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px dashed #206e4c;
            padding: 14px 0;
            color: #d0ffcf;
            font-weight: 450;
        }
        
        .history-guess {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            color: #c4ffc0;
            text-shadow: 0 0 4px #1a9e5c;
        }
        
        .history-result-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .history-result {
            color: #a8f0b5;
            font-weight: 700;
            background: #10332b;
            padding: 6px 18px;
            border: 2px solid #2d9e60;
            font-size: 24px;
        }
        
        .history-trophy {
            color: #ffdb7e;
            font-size: 28px;
            filter: drop-shadow(0 0 8px gold);
        }

        .empty-history {
            color: #73b388;
            font-size: 24px;
            padding: 32px 0;
            text-align: center;
            width: 100%;
            font-weight: 500;
            text-shadow: 0 0 6px #0a4526;
        }

        /* å³ä¾§è¡¨æ ¼ */
        .right-table-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
        }

        .right-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            max-width: 550px;
        }

        .table-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .grid-table {
            border-collapse: collapse;
            border: 4px solid #27a86c;
            background: #0b1c1c;
            table-layout: fixed;
            width: auto;
            height: auto;
            margin: 0 auto;
        }
        .grid-table td {
            border: 2px solid #1f8e5a;
            width: 58px;
            height: 58px;
            text-align: center;
            vertical-align: middle;
            font-size: 26px;
            font-weight: 700;
            color: #d0ffc0;
            background-color: #0e1f20;
            cursor: pointer;
            transition: all 0.04s linear;
            text-shadow: 0 0 6px #0e8a4a;
            box-shadow: inset 0 0 12px #041010;
        }
        .grid-table td.green {
            background-color: #1a9a5c;
            background: radial-gradient(#37ce7c, #0f874a);
            color: black;
            text-shadow: 0 0 10px white;
            border-color: #a0f7b0;
            box-shadow: inset 0 0 24px #befac4;
        }
        .grid-table td.red {
            background-color: #a83232;
            background: radial-gradient(#d45c5c, #972828);
            color: white;
            text-shadow: 0 0 10px #ffbaba;
            border-color: #ffa07a;
            box-shadow: inset 0 0 24px #ffbcbc;
        }
        .grid-table td:hover {
            background-color: #1f5242;
            border-color: #62e6a6;
            transform: scale(0.97);
        }

        /* ç§˜å¯†æ¨¡å¼è¡¨æ ¼ç‰¹æ®Šæ–‡å­— */
        .secret-grid-text {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            font-weight: 900;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-layout">
            <!-- é¡µçœ‰ -->
            <div class="header-row">
                <div class="game-title" :class="{ 'glitch-text': secretMode }">â—ˆ çŒœæ•°å­— â—ˆ</div>
                <div class="header-controls">
                    <div class="difficulty-display" @click="toggleDifficultyMenu" :class="{ 'glitch-text': secretMode }">
                        <span>âš™ï¸ éš¾åº¦ {{ currentModeName }}</span>
                        <span style="font-size:22px;">â–¼</span>
                    </div>
                    <div v-if="showDifficultyMenu" class="difficulty-menu">
                        <div v-for="level in difficultyLevels" :key="level" 
                             class="difficulty-menu-item"
                             @click="selectDifficulty(level)">
                            {{ difficultyNames[level] }} ({{ level }}ä½ Â· 1~{{ level }})
                        </div>
                    </div>
                    
                    <button class="method-toggle" @click="toggleMethod" :class="{ 'glitch-text': secretMode }">
                        ğŸ¯ æ–¹æ³•: {{ currentMethod }}
                    </button>
                    <button class="reset-table-btn" @click="confirmResetTable" :class="{ 'glitch-text': secretMode }">
                        ğŸ”ƒ é‡ç½®è¡¨æ ¼
                    </button>
                </div>
            </div>

            <!-- ä¸‰åˆ—ç­‰å®½Â·å…¨å±…ä¸­ -->
            <div class="main-three-columns">
                <!-- å·¦ä¾§ æ¸¸æˆåŒº -->
                <div class="left-play-area">
                    <div class="left-inner">
                        <div class="row">
                            <label :class="{ 'glitch-text': secretMode }"></label>
                            <input 
                                type="text" 
                                v-model="userGuess" 
                                :maxlength="secretMode ? 9 : digitLength" 
                                :placeholder="secretMode ? 'è¯·è¾“å…¥æ•°å­—' : 'è¯·è¾“å…¥æ•°å­—'"
                                @keyup.enter="submitGuess"
                                :disabled="gameWon && !secretMode"
                                class="guess-input"
                            >
                        </div>
                        
                        <div class="button-group">
                            <button @click="submitGuess" :disabled="gameWon && !secretMode" class="guess-btn" :class="{ 'glitch-text': secretMode }">ğŸ¤” çŒœæµ‹</button>
                            <button @click="resetGame" :disabled="secretMode" :class="{ 'glitch-text': secretMode }">ğŸ”ƒ é‡ç½®</button>
                        </div>

                        <div v-if="errorMsg" class="error-message" :class="{ 'glitch-text': secretMode }">
                            âš ï¸ {{ errorMsg }}
                        </div>
                        <div v-if="gameWon" class="win-message" :class="{ 'glitch-text': secretMode }">
                            ğŸ† {{ currentModeName }} èƒœåˆ© ğŸ†
                        </div>
                        
                        <button class="howto-btn" @click="toggleTutorial" :disabled="secretMode" :class="{ 'glitch-text': secretMode }">
                            ğŸ“˜ å¦‚ä½•ç©
                        </button>
                        
                        <div v-if="showTutorial" class="tutorial-panel" :class="{ 'glitch-text': secretMode }">
                            <h3>ğŸ“Œ æˆ˜æœ¯æ‰‹å†Œ</h3>
                            <p>â€¢ è¾“å…¥æ•°å­—çŒœæµ‹</p>
                            <p>â€¢ ç³»ç»Ÿä¼šè¾“å‡ºçŒœå¯¹äº†å‡ ä¸ªæ•°å­—</p>
                            <p>â€¢ ç‚¹å‡»éš¾åº¦å¯åˆ‡æ¢éš¾åº¦</p>
                        </div>
                    </div>
                </div>

                <!-- ä¸­é—´ å†å²è®°å½• â€” æˆ˜æŠ¥å·¦å³å¸ƒå±€ -->
                <div class="middle-history-area">
                    <div class="history-container">
                        <div class="history-header">
                            <span :class="{ 'glitch-text': secretMode }">ğŸ“‹ æˆ˜æŠ¥</span>
                            <span :class="{ 'glitch-text': secretMode }"> {{ historyList.length }} æ¬¡</span>
                        </div>
                        <div class="history-list">
                            <div v-if="historyList.length === 0" class="empty-history" :class="{ 'glitch-text': secretMode }">
                                âŒ› æ— è®°å½•ï¼Œå¼€å§‹é¦–çŒœ
                            </div>
                            <div v-for="(item, idx) in historyList" :key="idx" class="history-item">
                                <span class="history-guess" :class="{ 'glitch-text': secretMode }">{{ item.guess }}</span>
                                <div class="history-result-wrapper">
                                    <span class="history-result" :class="{ 'glitch-text': secretMode }">{{ item.correct }}/{{ digitLength }}</span>
                                    <span v-if="item.correct === digitLength" class="history-trophy" :class="{ 'glitch-text': secretMode }">ğŸ†</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ Â· åŠ¨æ€NxNè¡¨æ ¼ â€” ç§˜å¯†æ¨¡å¼ä¸‹æ˜¾ç¤º9ä¸ªéšæœºå­—ç¬¦ -->
                <div class="right-table-area">
                    <div class="right-content">
                        <div class="table-container">
                            <table class="grid-table">
                                <tr v-for="row in secretMode ? 3 : digitLength" :key="'row'+row">
                                    <td v-for="col in secretMode ? 3 : digitLength" :key="'col'+col"
                                        :class="{
                                            green: !secretMode && isCellGreen(row, col) && methodState === 'å¯èƒ½',
                                            red: !secretMode && isCellRed(row, col) && methodState === 'æ’é™¤',
                                            'glitch-text': secretMode,
                                            'secret-grid-text': secretMode
                                        }"
                                        @click="!secretMode && toggleCell(row, col)">
                                        <!-- ç§˜å¯†æ¨¡å¼ï¼šæ˜¾ç¤º9ä¸ªéšæœºå­—ç¬¦ä¹‹ä¸€ï¼Œæ™®é€šæ¨¡å¼ï¼šæ˜¾ç¤ºè¡Œå· -->
                                        <span v-if="secretMode">{{ secretGridChars[(row-1)*3 + (col-1)] }}</span>
                                        <span v-else>{{ row }}</span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp, ref, computed, watch } = Vue;

        const app = createApp({
            setup() {
                // éš¾åº¦è¯æ¡
                const difficultyLevels = [3, 4, 5, 6, 7, 8, 9];
                const difficultyNames = {
                    3: 'ç»ƒä¹ ', 4: 'ç®€å•', 5: 'æ™®é€š',
                    6: 'å›°éš¾', 7: 'åœ°ç‹±', 8: 'ç‚¼ç‹±', 9: 'å´©å'
                };
                
                const selectedMode = ref(5);
                const secretDigits = ref([]);
                const userGuess = ref('');
                const gameWon = ref(false);
                const errorMsg = ref('');
                const historyList = ref([]);
                const showTutorial = ref(false);
                const showDifficultyMenu = ref(false);
                
                // ç§˜å¯†æ¨¡å¼çŠ¶æ€
                const secretMode = ref(false);
                // 9ä¸ªéšæœºå­—ç¬¦
                const secretGridChars = ref(Array(9).fill('0'));

                const digitLength = computed(() => selectedMode.value);
                const currentModeName = computed(() => difficultyNames[selectedMode.value]);

                function toggleDifficultyMenu() {
                    if (secretMode.value) return; // ç§˜å¯†æ¨¡å¼ä¸‹ç¦ç”¨
                    showDifficultyMenu.value = !showDifficultyMenu.value;
                }
                
                function selectDifficulty(level) {
                    if (secretMode.value) return;
                    selectedMode.value = level;
                    showDifficultyMenu.value = false;
                }

                function generateSecret(length) {
                    const arr = [];
                    for (let i = 1; i <= length; i++) arr.push(i);
                    for (let i = arr.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [arr[i], arr[j]] = [arr[j], arr[i]];
                    }
                    return arr;
                }

                const redCells = ref(new Set());
                const greenCells = ref(new Set());

                function resetTableToWhite() {
                    redCells.value = new Set();
                    greenCells.value = new Set();
                }

                function resetGame() {
                    if (secretMode.value) return; // ç§˜å¯†æ¨¡å¼ä¸‹é‡ç½®æŒ‰é’®å·²ç¦ç”¨ï¼Œæ­¤å¤„åŒé‡ä¿é™©
                    secretDigits.value = generateSecret(digitLength.value);
                    gameWon.value = false;
                    userGuess.value = '';
                    errorMsg.value = '';
                    historyList.value = [];
                    resetTableToWhite();
                    showTutorial.value = false;
                }

                secretDigits.value = generateSecret(5);

                // ç”Ÿæˆ9ä¸ªéšæœºå­—ç¬¦
                function generateRandomChars() {
                    const chars = '0123456789abcdefghijklmnopqrstuvwxyz';
                    const result = [];
                    for (let i = 0; i < 9; i++) {
                        result.push(chars[Math.floor(Math.random() * chars.length)]);
                    }
                    return result;
                }

                // è§¦å‘ç§˜å¯†æ¨¡å¼
                function activateSecretMode() {
                    if (selectedMode.value === 8 && !secretMode.value) { // ç‚¼ç‹± = 8
                        secretMode.value = true;
                        // æ·»åŠ åˆ°HTMLæ ¹å…ƒç´ ç±»
                        document.documentElement.classList.add('secret-mode');
                        // ç”Ÿæˆ9ä¸ªéšæœºå­—ç¬¦
                        secretGridChars.value = generateRandomChars();
                        // æ¸…ç©ºè¾“å…¥
                        userGuess.value = '';
                        errorMsg.value = '';
                        // æ¸…ç©ºå†å²ï¼Œè¥é€ ç¥ç§˜æ„Ÿ
                        historyList.value = [];
                    }
                }

                // æ ¡éªŒçŒœæµ‹ï¼ˆç§˜å¯†æ¨¡å¼ä¸‹ç‰¹æ®Šå¤„ç†ï¼‰
                function validateGuess(guessStr) {
                    if (secretMode.value) {
                        // ç§˜å¯†æ¨¡å¼ä¸‹ï¼Œä»»æ„è¾“å…¥çš†å¯ï¼Œæ— é™åˆ¶ï¼Œä½†æœ€é•¿9ä½
                        if (guessStr.length > 9) return 'ç§˜å¯†æ¨¡å¼ä¸‹æœ€å¤š9ä½';
                        return '';
                    }
                    
                    const len = digitLength.value;
                    if (guessStr.length !== len) return `å¿…é¡»è¾“å…¥ ${len} ä½æ•°å­—`;
                    if (!/^\d+$/.test(guessStr)) return 'åªèƒ½åŒ…å«æ•°å­—';
                    const set = new Set(guessStr);
                    if (set.size !== guessStr.length) return 'çŒœæµ‹æ•°å­—ä¸èƒ½é‡å¤';
                    const maxVal = len;
                    for (let ch of guessStr) {
                        const num = parseInt(ch,10);
                        if (num < 1 || num > maxVal) return `æ¯ä½å¿…é¡»æ˜¯ 1~${maxVal}`;
                    }
                    const already = historyList.value.some(item => item.guess === guessStr);
                    if (already) return `â€œ${guessStr}â€ å·²ç»çŒœè¿‡`;
                    return '';
                }

                function countCorrectPositions(guessArr) {
                    if (secretMode.value) {
                        // ç§˜å¯†æ¨¡å¼ä¸‹ä¸è®¡ç®—æ­£ç¡®ä½ç½®ï¼Œè¿”å›éšæœºå€¼0-9å¢åŠ ä¹±ç æ„Ÿ
                        return Math.floor(Math.random() * 10);
                    }
                    let correct = 0;
                    const secret = secretDigits.value;
                    for (let i = 0; i < secret.length; i++) {
                        if (parseInt(guessArr[i], 10) === secret[i]) correct++;
                    }
                    return correct;
                }

                function submitGuess() {
                    if (gameWon.value && !secretMode.value) {
                        errorMsg.value = 'æ¸¸æˆå·²èƒœåˆ©ï¼Œç‚¹å‡»ã€é‡ç½®ã€‘';
                        return;
                    }
                    
                    const guessStr = userGuess.value.trim();
                    
                    // ç§˜å¯†æ¨¡å¼è§¦å‘æ¡ä»¶ï¼šç‚¼ç‹±éš¾åº¦ + è¾“å…¥"CyanBurn"
                    if (selectedMode.value === 8 && guessStr === 'CyanBurn' && !secretMode.value) {
                        activateSecretMode();
                        return;
                    }
                    
                    const validationError = validateGuess(guessStr);
                    if (validationError) {
                        errorMsg.value = validationError;
                        return;
                    }
                    errorMsg.value = '';
                    
                    if (secretMode.value) {
                        // ç§˜å¯†æ¨¡å¼ä¸‹ï¼šå°†çŒœæµ‹åŠ å…¥å†å²ï¼Œæ˜¾ç¤ºéšæœºæ­£ç¡®æ•°ï¼Œä¸æ¸…ç©ºè¾“å…¥ï¼ˆä¿ç•™è¾“å…¥ä»¥ä¾¿è¿ç»­è§¦å‘ï¼‰
                        const randomCorrect = Math.floor(Math.random() * 10);
                        historyList.value.push({ 
                            guess: guessStr, 
                            correct: randomCorrect 
                        });
                        // ç§˜å¯†æ¨¡å¼ä¸‹ä¸æ¸…ç©ºè¾“å…¥ï¼Œæ–¹ä¾¿è¿ç»­è¾“å…¥
                        // ä¸æ£€æŸ¥èƒœåˆ©æ¡ä»¶ï¼Œæ°¸è¿œä¸èƒœåˆ©ï¼Œä¿æŒæ··ä¹±
                    } else {
                        const guessArray = guessStr.split('');
                        const correctPositions = countCorrectPositions(guessArray);
                        historyList.value.push({ guess: guessStr, correct: correctPositions });
                        if (correctPositions === digitLength.value) gameWon.value = true;
                        userGuess.value = ''; // æ™®é€šæ¨¡å¼æ¸…ç©º
                    }
                }

                watch(selectedMode, () => {
                    if (!secretMode.value) {
                        resetGame();
                    }
                });

                watch(showDifficultyMenu, (val) => {
                    if (val && !secretMode.value) {
                        setTimeout(() => {
                            const closeMenu = (e) => {
                                if (!e.target.closest('.difficulty-display') && !e.target.closest('.difficulty-menu')) {
                                    showDifficultyMenu.value = false;
                                    document.removeEventListener('click', closeMenu);
                                }
                            };
                            document.addEventListener('click', closeMenu);
                        }, 0);
                    }
                });

                const methodState = ref('æ’é™¤');
                function toggleMethod() {
                    if (secretMode.value) return;
                    methodState.value = methodState.value === 'æ’é™¤' ? 'å¯èƒ½' : 'æ’é™¤';
                }
                const currentMethod = computed(() => methodState.value);

                function isCellGreen(row, col) {
                    return greenCells.value.has(`${row},${col}`);
                }
                function isCellRed(row, col) {
                    return redCells.value.has(`${row},${col}`);
                }

                function toggleCell(row, col) {
                    if (secretMode.value) return;
                    const key = `${row},${col}`;
                    if (methodState.value === 'æ’é™¤') {
                        const newRed = new Set(redCells.value);
                        if (newRed.has(key)) newRed.delete(key);
                        else newRed.add(key);
                        redCells.value = newRed;
                    } else {
                        const newGreen = new Set(greenCells.value);
                        if (newGreen.has(key)) newGreen.delete(key);
                        else newGreen.add(key);
                        greenCells.value = newGreen;
                    }
                }

                function confirmResetTable() {
                    if (secretMode.value) return;
                    if (confirm('æ˜¯å¦é‡ç½®è¡¨æ ¼ï¼Ÿ')) {
                        resetTableToWhite();
                    }
                }

                function toggleTutorial() {
                    if (secretMode.value) return;
                    showTutorial.value = !showTutorial.value;
                }

                return {
                    difficultyLevels,
                    difficultyNames,
                    selectedMode,
                    userGuess,
                    gameWon,
                    errorMsg,
                    historyList,
                    digitLength,
                    currentModeName,
                    showDifficultyMenu,
                    toggleDifficultyMenu,
                    selectDifficulty,
                    submitGuess,
                    resetGame,
                    methodState,
                    currentMethod,
                    toggleMethod,
                    redCells,
                    greenCells,
                    isCellGreen,
                    isCellRed,
                    toggleCell,
                    confirmResetTable,
                    showTutorial,
                    toggleTutorial,
                    // ç§˜å¯†æ¨¡å¼
                    secretMode,
                    secretGridChars,
                };
            }
        });

        app.mount('#app');
    </script>
</body>
</html>
